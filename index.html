<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Links</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #121212;
            color: white;
        }
        input, button, select {
            margin: 10px;
            padding: 10px;
            background-color: #333;
            color: white;
            border: 1px solid #555;
        }
        button {
            cursor: pointer;
        }
        ul {
            list-style: none;
            padding: 0;
        }
        li {
            margin: 5px 0;
        }
        a {
            color: #4DB6AC;
        }
        .theme-toggle {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            cursor: pointer;
            background-color: #333;
            border: 1px solid #555;
            color: white;
        }
        .light-theme {
            background-color: white;
            color: black;
        }
        .light-theme input, .light-theme button, .light-theme select {
            background-color: white;
            color: black;
            border: 1px solid #ccc;
        }
        .light-theme a {
            color: #007BFF;
        }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()">Theme</button>
    <h1>My Links</h1>
    <input type="text" id="nameInput" placeholder="Enter link name">
    <input type="text" id="linkInput" placeholder="Enter a link">
    <input type="text" id="categoryInput" placeholder="Enter category">
    <button onclick="addLink()">Add Link</button>
    <h2>Categories</h2>
    <select id="categorySelect" onchange="loadLinks()">
        <option value="">All</option>
    </select>
    <ul id="linkList"></ul>

    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDUoWztgPgZfEAVXs4_E3LnOwK0I-uGpdk",
            authDomain: "links-manger.firebaseapp.com",
            projectId: "links-manger",
            storageBucket: "links-manger.firebasestorage.app",
            messagingSenderId: "947928555709",
            appId: "1:947928555709:web:70f1b67765ac3d5b2d57d4",
            measurementId: "G-8JJZZVK2E7"
        };
    
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
    
        // Function to add a link to Firestore
        async function addLink() {
            const name = document.getElementById("nameInput").value.trim();
            const link = document.getElementById("linkInput").value.trim();
            const category = document.getElementById("categoryInput").value.trim();
    
            if (name && link && category) {
                try {
                    await addDoc(collection(db, "links"), { name, url: link, category });
                    document.getElementById("nameInput").value = "";
                    document.getElementById("linkInput").value = "";
                    document.getElementById("categoryInput").value = "";
                    loadCategories();
                    loadLinks();
                } catch (error) {
                    console.error("Error adding document: ", error);
                }
            }
        }
    
        // Load links from Firestore
        async function loadLinks() {
            const linkList = document.getElementById("linkList");
            linkList.innerHTML = "";
            const selectedCategory = document.getElementById("categorySelect").value;
    
            let q = collection(db, "links");
            if (selectedCategory) {
                q = query(q, where("category", "==", selectedCategory));
            }
    
            try {
                const querySnapshot = await getDocs(q);
                querySnapshot.forEach((doc) => {
                    const li = document.createElement("li");
                    const a = document.createElement("a");
                    a.href = doc.data().url;
                    a.textContent = `${doc.data().name} - ${doc.data().url}`;
                    a.target = "_blank";
                    li.appendChild(a);
                    linkList.appendChild(li);
                });
            } catch (error) {
                console.error("Error loading documents: ", error);
            }
        }
    
        // Load categories dynamically
        async function loadCategories() {
            const categorySelect = document.getElementById("categorySelect");
            categorySelect.innerHTML = '<option value="">All</option>';
            const categories = new Set();
    
            try {
                const querySnapshot = await getDocs(collection(db, "links"));
                querySnapshot.forEach((doc) => {
                    categories.add(doc.data().category);
                });
                categories.forEach(category => {
                    const option = document.createElement("option");
                    option.value = category;
                    option.textContent = category;
                    categorySelect.appendChild(option);
                });
            } catch (error) {
                console.error("Error loading categories: ", error);
            }
        }
    
        // Toggle Dark/Light Theme
        function toggleTheme() {
            document.body.classList.toggle("light-theme");
        }
    
        // Load links and categories on page load
        window.onload = function() {
            loadCategories();
            loadLinks();
        };
    
        // Attach functions to window object so buttons can call them
        window.addLink = addLink;
        window.toggleTheme = toggleTheme;
    </script>
    
</body>
</html>
